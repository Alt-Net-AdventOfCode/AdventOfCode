using System;
using System.Collections.Generic;
using System.Linq;
using System.Text;
using AOCHelpers;

namespace AdventCalendar2020.Day20
{
    public class DupdobDay20 : DupdobDayWithTest
    {

        protected override void Parse(string input)
        {
            var currentTile = 0;
            foreach (var line in input.Split('\n'))
            {
                if (string.IsNullOrEmpty(line))
                {
                    continue;
                }
                if (line.StartsWith("Tile "))
                {
                    currentTile = int.Parse(line.Substring(5, 4));
                    _tiles[currentTile] = new List<string>();
                }
                else
                {
                    _tiles[currentTile].Add(line.Trim());
                }
            }
        }

        public override object GiveAnswer2()
        {
            var map = new Dictionary<(int x, int y), List<string>>();
            var tilesToDo = _tiles.Keys.ToList();
            var fullMap = new List<string>();

            var tile = tilesToDo[0];
            AddMap(tile, 2, 1, map, (0,0), tilesToDo);

            var minX = map.Min(t => t.Key.x);
            var maxX = map.Max(t => t.Key.x);
            var minY = map.Min(t => t.Key.y);
            var maxY = map.Max(t => t.Key.y);

            var mapSize = _tiles.First().Value.Count;
            var builder = new StringBuilder();
            for (var y = minY; y <= maxY; y++)
            {
                for (var line = 0; line < mapSize; line++)
                {
                    for (var x = minX; x <= maxX; x++)
                    {
                        builder.Append(map[(x, y)][line].Substring(1, mapSize-2));
                    }

                    // skip borders
                    if (line > 0 && line < mapSize - 1)
                    {
                        fullMap.Add(builder.ToString());
                    }
                    builder.Clear();
                }
            }

            // compress pixels
            var monsterPixels = new List<(int dy, int dx)>();
            var dy = 0;
            foreach (var monsterLine in SeaMonster.Split('\n'))
            {
                for (var i = 0; i < monsterLine.Length; i++)
                {
                    if (monsterLine[i] == '#')
                    {
                        monsterPixels.Add((dy, i));
                    }
                }
                dy++;
            }

            var length = monsterPixels.Max( p => p.dx);
            var height = monsterPixels.Max(p => p.dy);
            var foundMonsters = 0;
            for (var index = 0; index < 8; index++)
            {
                var localMonsters = 0;
                var rotation = index % 4;
                var flip = index > 3 ? 1 : 0;
                var transformedMap = RotateFlipAndExtract(fullMap, rotation, flip);
                for (var y = 0; y < transformedMap.Count - height; y++)
                {
                    for (var x = 0; x < transformedMap[0].Length - length; x++)
                    {
                        if (monsterPixels.All(p => transformedMap[p.dy + y][p.dx + x] == '#'))
                        {
                            localMonsters++;
                        }
                    }
                }

                foundMonsters = Math.Max(foundMonsters, localMonsters);
            }
            return fullMap.SelectMany(t => t).Count(p => p=='#') - foundMonsters*monsterPixels.Count();
        }

        private void AddMap(int tile, int orientation,
            int actualFlip,
            IDictionary<(int x, int y), List<string>> map, (int x, int y) pos, ICollection<int> tilesToDo)
        {
            if (!tilesToDo.Contains(tile))
            {
                // done already
                return;
            }

            tilesToDo.Remove(tile);

            var (x, y) = pos;
            map[pos] = RotateFlipAndExtract(_tiles[tile], orientation, actualFlip);

            // process neighbour tiles
            var offsets = new[] {(0, -1), (1, 0), (0, 1), (-1, 0)};
            for (var i = 0; i < _compatibility[tile].Length; i++)
            {
                if (_compatibility[tile][i].Count != 1) continue;
                // we need to convert this to the actual direction, taking into account rotation(s) and flip(s)
                var (nextTile, border, flipIt) = _compatibility[tile][i][0];
                var actualDirection =  ((actualFlip == 0 ? i : 4 - i) + orientation) % 4;
                
                if (!tilesToDo.Contains(nextTile)) continue;
                flipIt ^= actualFlip;
                if (flipIt != 0)
                {
                    if ((border & 1) == 1)
                    {
                        border ^=2;
                    }
                }
                var rotation = (actualDirection-border+6)%4;
                var (dx, dy) =  offsets[actualDirection];
                AddMap(nextTile, rotation, flipIt, map, (x + dx, y + dy), tilesToDo);
            }
        }

        private static List<string> RotateFlipAndExtract(IReadOnlyList<string> map, int rotate, int flip)
        {
            var list = new List<string>();
            for (var i = 0; i < map.Count ; i++)
            {
                var lineBuilder = new StringBuilder();
                foreach (var car in RotateFlipAndExtract(map, i, rotate, flip))
                {
                    lineBuilder.Append(car);
                }
                list.Add(lineBuilder.ToString());
            }

            return list;
        }

        // extract one line/column (depends on rotation)
        private static IEnumerable<char> RotateFlipAndExtract(IReadOnlyList<string> map, int index, int rotate, int flip)
        {
            var max = map.Count - 1;
            var reversedIndex = map.Count-1 - index;
            switch (rotate)
            {
                case 0:
                    if (flip == 0)
                    {
                        for (var i = 0; i <= max; i++)
                            yield return map[index][i];
                    }
                    else
                    {
                        for (var i = max; i >= 0; i--)
                            yield return map[index][i];
                    }

                    break;
                case 1:
                    if (flip == 0)
                    {
                        for (var i = max; i >= 0; i--)
                            yield return map[i][index];
                    }
                    else
                    {
                        for (var i = max; i >= 0 ; i--)
                            yield return map[i][reversedIndex];
                    }
                    break;
                case 2:
                    if (flip == 0)
                    {
                        for (var i = max; i >= 0; i--)
                            yield return map[reversedIndex][i];
                    }
                    else
                    {
                        for (var i = 0; i <= max ; i++)
                            yield return map[reversedIndex][i];
                    }
                    break;
                case 3:
                    if (flip == 0)
                    {
                        for (var i = 0; i <= max; i++)
                            yield return map[i][reversedIndex];
                    }
                    else
                    {
                        for (var i = 0; i <= max; i++)
                            yield return map[i][index];
                    }
                    break;
            }
        }
        
        public override object GiveAnswer1()
        {
            var bordersMap = new Dictionary<int, string[]>();
            foreach (var (tile, tileLine) in _tiles)
            {
                var borders = new string[4];
                borders[0] = tileLine[0];
                borders[2] = string.Concat(tileLine.Last().Reverse());
                var builderRight = new StringBuilder(10);
                var builderLeft = new StringBuilder(10);
                foreach (var line in tileLine)
                {
                    builderLeft.Insert(0, line.First());
                    builderRight.Append(line.Last());
                }

                borders[1] = builderRight.ToString();
                borders[3] = builderLeft.ToString();

                bordersMap[tile] = borders;
            }

            _compatibility = new Dictionary<int, List<(int tile, int border, int flip)>[]>();
            
            foreach (var tile in bordersMap)
            {
                _compatibility[tile.Key] = new List<(int, int, int)>[4];
                for (var i = 0; i < 4; i++)
                {
                    var border = tile.Value[i];
                    var reversedBorder = string.Concat(border.Reverse());
                    var list = new List<(int tile, int border, int flip)>();
                    foreach (var t in bordersMap)
                    {
                        if (t.Key == tile.Key)
                            continue;
                        for (var j = 0; j < 4; j++)
                        {
                            if (reversedBorder == t.Value[j])
                            {
                                list.Add((t.Key, j, 0));
                            }
                            else if (border == t.Value[j])
                            {
                                list.Add((t.Key, j, 1));
                            }
                        }
                    }

                    _compatibility[tile.Key][i] = list;
                }
            }

            return _compatibility.Where(tile => tile.Value.Count(t => t.Count == 1) == 2).Aggregate(1L, (current, tile) => current * tile.Key);
        }

        protected override void ParseLine(int index, string line)
        {
        }

        protected override void SetupTestData()
        {
            ExpectedResult1 = 20899048083289L;
            ExpectedResult2 = 273;
            TestData = @"Tile 2311:
..##.#..#.
##..#.....
#...##..#.
####.#...#
##.##.###.
##...#.###
.#.#.#..##
..#....#..
###...#.#.
..###..###

Tile 1951:
#.##...##.
#.####...#
.....#..##
#...######
.##.#....#
.###.#####
###.##.##.
.###....#.
..#.#..#.#
#...##.#..

Tile 1171:
####...##.
#..##.#..#
##.#..#.#.
.###.####.
..###.####
.##....##.
.#...####.
#.##.####.
####..#...
.....##...

Tile 1427:
###.##.#..
.#..#.##..
.#.##.#..#
#.#.#.##.#
....#...##
...##..##.
...#.#####
.#.####.#.
..#..###.#
..##.#..#.

Tile 1489:
##.#.#....
..##...#..
.##..##...
..#...#...
#####...#.
#..#.#.#.#
...#.#.#..
##.#...##.
..##.##.##
###.##.#..

Tile 2473:
#....####.
#..#.##...
#.##..#...
######.#.#
.#...#.#.#
.#########
.###.#..#.
########.#
##...##.#.
..###.#.#.

Tile 2971:
..#.#....#
#...###...
#.#.###...
##.##..#..
.#####..##
.#..####.#
#..#.#..#.
..####.###
..#.#.###.
...#.#.#.#

Tile 2729:
...#.#.#.#
####.#....
..#.#.....
....#..#.#
.##..##.#.
.#.####...
####.#.#..
##.####...
##..#.##..
#.##...##.

Tile 3079:
#.#.#####.
.#..######
..#.......
######....
####.#..#.
.#...#.##.
#.#####.##
..#.###...
..#.......
..#.###...
";
        }

        protected override void CleanUp()
        {
            _tiles.Clear();
        }

        private readonly Dictionary<int, List<string>> _tiles = new();
        private Dictionary<int, List<(int tile, int border, int flip)>[]> _compatibility;

        private const string SeaMonster = @"                  # 
#    ##    ##    ###
 #  #  #  #  #  #   ";

        protected override string Input => @"Tile 1759:
.##.#..#..
..........
..#..#...#
##....####
###.##.##.
.#.#.#..#.
......#..#
##.....#..
..........
.##....#..

Tile 3803:
#.#.#.#.#.
#.........
#.....#...
#...#..#.#
#....#....
#..#.#...#
.##.#.##.#
#........#
#..#...#..
..#####.#.

Tile 2351:
......###.
##...##.##
.........#
..#.#.....
....#.##..
#.#.#.#.##
.##.#.##.#
....#...##
#..#...###
#.##...##.

Tile 2467:
#####.#.##
#........#
#.#....###
.......##.
....#....#
#.........
.......#.#
##.#..#..#
.#....#.##
..#....###

Tile 1933:
##.....###
#.#......#
....#...##
#.###.....
#.##.#..#.
....#....#
....##....
##........
#..##....#
.#.#.#...#

Tile 2971:
#.#.#.#..#
.........#
......#..#
##...#....
...###....
#....##...
.....#.#..
#....#.#.#
#.......#.
.###...#.#

Tile 2731:
.....#####
..##......
.......##.
.#........
#..#.#....
..........
#..##.#...
.#..###...
#.#..#....
..#.#.....

Tile 2423:
.####.#...
#.##.#...#
.....##...
##........
..#..#..##
#...######
....#...##
.....##...
...#...###
##.#..###.

Tile 1877:
.#...##..#
#..##....#
#.##......
...#......
.#........
#........#
#.....##.#
#.....##..
.........#
..####.#..

Tile 3461:
....##.##.
....##....
###......#
#.#...#...
#........#
.##..#.#.#
#.....#.#.
#.......#.
#........#
#.#.##.###

Tile 2137:
##.#.#...#
#..#.##..#
.##......#
#..#.#...#
###.#....#
#........#
#....#..#.
#...##.##.
...#.###..
##...#...#

Tile 2647:
##.##..#..
......#..#
.....#....
##......##
#.#.#..###
##.......#
#...###...
##...##..#
.....#....
###....##.

Tile 3253:
......#.#.
#.......#.
##..##....
#.#.##...#
.....#...#
...#..#..#
#.....#...
.#...#....
.#..#.##..
.###...##.

Tile 1409:
.###.###.#
#..#.##.##
........##
.###......
#####.####
..#..#.#.#
..#...##.#
..##..#.##
....#....#
####.....#

Tile 2503:
###.....##
.....#..#.
#...##....
.##..##..#
...#...#.#
.#..#.#...
#...#...##
#.........
##...#...#
...#....#.

Tile 1879:
.######.##
......#..#
..#.#..##.
..........
#..#.....#
.##.......
#.......##
..........
.........#
#.#.#.##..

Tile 3739:
#..#.#....
#.....#...
#.........
##....#..#
###..##..#
..#...#..#
#.####....
.##.......
.##......#
###..#.###

Tile 2713:
..#..#..#.
#.........
.#.....###
.#.##.#.##
.#.#.##...
.##..#.#.#
..####..#.
#..##.....
#....#....
.#..####..

Tile 2243:
#.##...##.
...#......
..#..#..##
....#....#
#....####.
.##.#...##
#..#..#...
#..###...#
#.##.#####
.#..#.###.

Tile 3307:
...####..#
....#.....
.###......
..#.......
.....#...#
#...#....#
#...#.....
.........#
#..###....
#####..#.#

Tile 2161:
###.#.#..#
#.#...###.
.##......#
##.#..#.#.
#.#.#..#.#
#..#.#....
...#....##
#.##...#.#
#......#..
..#.#.####

Tile 3257:
....##..##
#.........
..#..##.##
.#......#.
#...#....#
#.#...#.#.
....##...#
###....##.
.##...#..#
.#...#..##

Tile 1997:
..#.##.###
....#.....
..#......#
.#.#..#.#.
###...#.##
.#......##
..........
#........#
..#..#..##
##.#.#####

Tile 2741:
#####..###
#..#.....#
#...#...#.
....##...#
...#......
#..##.#...
###....###
........#.
##.###....
...#...###

Tile 2671:
##....#..#
........#.
.##.#..###
......##.#
#..#....##
....#...#.
#.#......#
###......#
...#......
..###.##.#

Tile 3943:
####...#.#
#..##.....
.#......#.
......##..
..#.....##
#...#....#
....##.#.#
..........
..#....#.#
..#.....##

Tile 1283:
..##...###
#..#....#.
#...#.....
.#.....##.
#.##....##
.#..#...#.
#....#...#
##....#...
.##...####
##..##.###

Tile 3067:
#.#.#.#.#.
#..#......
..##......
#..#...#.#
.##.#....#
......#...
#...#.#.##
.#..##..#.
...#...###
...##..#..

Tile 2957:
.#..###...
#........#
......#.##
...#..##.#
###....#.#
.....#..##
#.......#.
#....##.#.
......#.##
.##..#..##

Tile 1571:
..#...##.#
#..####..#
#.........
.#.###..##
#.....##.#
......#...
..#.......
.#........
........#.
####.#..##

Tile 1481:
#.#..##...
#...#....#
#.....#..#
..#......#
.#...#.#.#
....#..###
.#.###....
.....###..
.#....#..#
####..#..#

Tile 1637:
#.##...#..
.........#
#........#
.###.....#
##..#..#..
.#....#...
.......#.#
.....#....
#..##..#.#
#..###.#.#

Tile 1567:
####.#.#.#
...##.....
......#...
.#...##...
#.#....#.#
#.#......#
.###.....#
##..#..#..
...#......
########..

Tile 1117:
#..#.#.#.#
....#....#
.#.#..##..
....#.##..
##..#.....
...#......
#....#...#
...##..#.#
...#....#.
.#..#.##..

Tile 1663:
####..#...
#.#......#
......#...
....#..##.
#......#.#
...##....#
#........#
#.#..#...#
####.#....
..####.##.

Tile 3079:
.#....####
.#......#.
..........
......#..#
###..#.#.#
...#....##
..##.#####
..#.###..#
....##....
.#.######.

Tile 2011:
##.###....
..##.#.##.
##.##..#..
##.....##.
#...#...#.
.#.##.##.#
###..#.###
..#....#..
#.##..####
.......##.

Tile 1801:
.#..##..##
..#.###..#
....##....
#...#.#...
..##......
#.....#...
#.........
..##....##
#.#.#..#.#
..#.#..##.

Tile 1499:
...#..####
#.......#.
..........
#.....#..#
#..###....
#..#..##.#
...##.#..#
..#......#
..#.......
#.######..

Tile 1061:
###.#...##
#..###.##.
##.#......
#.#...#...
.....#..##
.#....#.#.
...#...#.#
...###....
.##..##.#.
#.#...#.##

Tile 1783:
#...####.#
#.....####
.#........
......##.#
..##....##
..#......#
#...#.#...
#........#
.#...#...#
.#######..

Tile 1301:
#.....#.##
#....#...#
#.##.#...#
.#..#.#..#
.#....#.#.
....##.##.
##..#...#.
.#...#.#..
...#.#....
..##......

Tile 1259:
#..###..##
....###..#
.#...#..#.
.....#...#
.#.##.....
#..#......
#.#.....#.
#...#....#
.....#.##.
#####...##

Tile 3823:
#..##..#..
#...#.....
.#.......#
#..#.##.#.
..........
#....#....
#.#.....##
..#.#.#...
..#......#
#..####.##

Tile 3181:
#.........
#......###
##....##..
......##.#
...#.##...
#.#..#...#
#.......#.
##...#....
#.....##.#
.####.####

Tile 3251:
...###.##.
...#.....#
##...#...#
#.####..##
...#.#..##
..#...#.##
##....#..#
.##.......
...#.#...#
..##..####

Tile 3121:
#..#....#.
#..##.#...
....#....#
#....#..#.
...#.....#
....#.....
.....#...#
...###...#
#..##...#.
.####.#...

Tile 3209:
##....#...
##.......#
.......#..
###.#...#.
..........
..#...#..#
..#.##..#.
##..#.....
#..####...
###..##..#

Tile 1049:
..#..#....
....##....
...#......
#...#.....
#..#.....#
...#.....#
.#.....##.
..#.#.##.#
..##.#.#.#
.##.###.#.

Tile 3671:
.###......
..###..#.#
....#.....
####......
#.#.#.....
#.......#.
..##...#..
.....#....
.##..#....
.##.#..##.

Tile 1171:
...###.##.
#.........
#.........
#........#
....##.#.#
#.....#..#
##..#.....
.......#..
...#.....#
.#####.###

Tile 3259:
###..##.#.
#..###..##
......##..
..#...#.#.
...#.#....
##....#..#
..#...##.#
.#....##..
........#.
.######...

Tile 1601:
#..#.#.###
......####
.#...##...
#......###
#...#....#
#....#.#.#
#...#..##.
..###.#...
#....##..#
.#.#..###.

Tile 2371:
.#.....#..
#.#..##...
.....#####
###..#.##.
#.####.#..
........#.
###......#
.........#
.......###
.##.###.#.

Tile 2153:
.#....#..#
#....#..##
#.........
.....##...
##.....##.
#.#......#
.#..##...#
##.#.#.#..
...#.....#
.#.##.##..

Tile 2269:
.#.#.#....
...#.....#
..#....#..
#.#.......
.#.#......
........##
..........
...#.....#
#.##...#.#
#.#....#..

Tile 1291:
##.##..#.#
##.#......
##..#.....
###...##..
.#..#.#..#
##...#...#
..#####...
###..####.
#.#......#
.#.#.##...

Tile 1487:
.##..##...
..#.#.##..
#...#...##
..#.#...#.
.###...#.#
..##.....#
...#.#...#
#.....#..#
#..#......
.##.#.####

Tile 3023:
########..
.#..#..#.#
###.###...
#.#......#
##.#.#..#.
.....#....
##..#.....
.##.......
.##......#
###..#...#

Tile 2887:
..#.#..#..
...#......
.......#.#
.......#..
#......#.#
#...#....#
..#....###
........#.
.#...#.##.
#.#..#.#..

Tile 2333:
#....##.#.
.#.......#
#....##..#
........##
#.........
..........
...##.#..#
#.#.#.....
.........#
###..#.##.

Tile 2311:
...####.#.
##.#......
#.#.......
#.##....##
...#.#..##
..#....#..
###.......
..#.##....
.#.###...#
#...###.##

Tile 1039:
.#..#.#.#.
....###...
##.......#
.##.......
..#......#
..........
#......#..
#....##..#
#.....#..#
..#.##..##

Tile 3571:
....#....#
#...#...##
##......##
..........
..#.......
.........#
...##.##.#
.#####....
.....#....
.#..#.....

Tile 2221:
##.#.###..
.###..#...
.#...#...#
#....#....
#..#.#....
#.#......#
#......###
..##.#....
#...###..#
#.##......

Tile 1361:
.#.#.#.#..
.##..##...
...##.....
#...##..##
##.##..#.#
...#..#...
#...#..#..
#........#
...#......
#..#...###

Tile 3637:
.#####...#
#........#
#..##.#.#.
#.........
#..##.....
.#....#...
...#....##
...###..#.
#....#.#..
##.#.#..##

Tile 3083:
.#....#.##
#....#....
#...#...#.
....#....#
.#.#..##.#
######..#.
#.###.....
.#........
#........#
###..###..

Tile 1619:
.###...##.
#....#...#
..#..#....
#...#.####
#.....#.#.
#..#......
..#..##..#
#..###....
#..#.#.#..
#..##..#.#

Tile 2063:
.#..#.....
#....#....
#..#.###..
#.#...#...
#....##.##
#...##..#.
#........#
..#...#...
...#..#...
#......#..

Tile 3911:
##..##....
##.......#
###....###
##.#.###.#
..#.......
#..#.#.###
.#.#.#.###
####..####
..##.##.#.
......#..#

Tile 2447:
#.......#.
##...##.#.
#.#..#...#
......###.
.#....#.##
..#...#..#
....#.#..#
#...#....#
..#.......
...##.#...

Tile 3191:
.#....#.#.
#..#...#.#
........##
....#..#..
#......#.#
#...##....
#......#.#
.##...#...
##....#...
#.####...#

Tile 1733:
..###..###
..........
#.##....#.
#..#...#.#
#..#.....#
..........
.........#
.......#..
#........#
.#.##.....

Tile 3533:
###.#...##
.........#
...##.#.#.
#........#
#..#...#..
.#.......#
#.#...#...
##.#..##..
#...##.###
...#.#.#.#

Tile 3767:
.######..#
##.#####..
....#.#...
#....##..#
.....#.#.#
#...#..#..
#...#...##
#.###.#..#
..........
#.#.#..#.#

Tile 2531:
.#.#...#..
....#....#
......#..#
#...#....#
##.......#
.#..####..
..##..#.##
#........#
#.....####
..##..####

Tile 3329:
##..#.##.#
....#...#.
##..#..#.#
##..#.#.##
...#...#..
.#####...#
...#....##
###...#...
..........
#######.##

Tile 2473:
##.#.####.
#.#.......
.......#.#
#.#.#.#...
....#..#..
#####....#
#..#..##..
#...#.....
.....#.#.#
##.#...##.

Tile 2851:
#......#..
#.#....##.
..........
#..##...##
#.#.#....#
#...#.....
#.#...##.#
##.#.#..##
#.#.......
##.##.....

Tile 2111:
#..###..#.
#...#.#.##
#.....#...
#.....####
#..##.#...
....##..#.
....#.....
...###.###
..#.#.....
#..#..#.##

Tile 3001:
..#.###...
......##..
..#...####
#..#.#....
##..#.....
..#.....##
.....##..#
.#.#..#..#
#.....#.##
..##......

Tile 2549:
.#..#..###
#..#.#.##.
.....#....
####..#..#
......#.#.
#.....#.#.
..........
##..#...##
...##....#
...###..#.

Tile 3989:
.......#.#
..##.#.###
#..##..#.#
..........
.#.##..#..
.....#...#
..#.#..###
.....###..
##...##...
.####.....

Tile 3049:
##...#####
###.#...##
#....#...#
#........#
#....#....
##..##..#.
..###.#..#
#.###.....
#...#.....
#.####.#.#

Tile 1721:
..###.#.##
#........#
.#.#...#.#
#.##.#.###
#..###..##
.....##..#
##.#.##..#
#......#.#
....##.#..
.#.......#

Tile 2791:
###.#.#...
#....#....
....##...#
...#.##.##
...#...#..
...###.##.
.#.#..#..#
##.##...##
.##..#.##.
#..##..###

Tile 2083:
#.#..#..##
.#....##.#
..#......#
#.........
....##...#
.......#.#
..###....#
###.....#.
###....##.
...#.#...#

Tile 3613:
.###.#..#.
#.#..##..#
#.###.#...
.#.....#.#
......#..#
......#...
.#.#...#.#
#.......##
......#..#
#..#.#.#..

Tile 1201:
..#.#...#.
#.....#...
#..##..#..
.#...#...#
#..##....#
#..#..#..#
.##.#..#.#
#..#......
...#..#...
#...##..##

Tile 3119:
#..#.##..#
#.#...#...
##....#.#.
#..#..#.##
#.........
...##..##.
#...#..#.#
#.........
#..#....#.
#.##.#.##.

Tile 2459:
.#....###.
....#.#...
#..#.#....
#...#..#..
#........#
.#.#......
....#...#.
#...#....#
..#.#.....
##.##..###

Tile 2341:
#..#..###.
#.#......#
#.#....#.#
##........
.#.##..#.#
.###......
.......#.#
##...#.#..
####...#.#
.#...###.#

Tile 3011:
###..#..##
...#.###..
#........#
.##.#...#.
.....#####
........##
.........#
#......#..
###.......
#..###.###

Tile 3727:
#.###..##.
#...#....#
...#....##
##..#....#
.........#
##..#.....
#.........
.##.......
#.##.###.#
#..#.#...#

Tile 2659:
#.##.###..
.........#
#...#..#..
.#..#.#...
....##...#
#..#.##...
#.##.....#
..........
...##..#..
#.##..#.#.

Tile 2657:
#...######
..#...#...
..#......#
...#...#..
......###.
#......##.
#..#..#..#
#.#.#..#..
.###..#...
#......###

Tile 2789:
#.....#..#
...#..###.
#.#.......
#........#
.#.#....#.
...#.....#
.#.....###
##.##....#
.##...#...
#####..#.#

Tile 1627:
#.##..#.##
#...##.#.#
....#....#
##..#...##
.....#...#
.#..#....#
........#.
#.#.###.##
.#.##.#..#
.#.###.#..

Tile 3167:
..###.#...
.....#..##
#..##.....
#.#..##.#.
#.....#.##
####.....#
#.###..#..
.##....#..
.#..#.....
#....#.#.#

Tile 3229:
###...#.##
##....##..
#.......##
...##....#
#.#.....#.
........##
##...#...#
#........#
..#......#
..#.....##

Tile 2383:
#.####.###
.#.#...#..
####..#.#.
.#..#.#..#
..#.#..#..
##.....#..
.....#.#.#
...##..#.#
##...####.
##...#.#.#

Tile 1381:
#.#.#.####
........##
.#..#..#..
#.....##..
.#...#.#.#
#.....#..#
...##..#..
..####....
##........
..######.#

Tile 3089:
..#..####.
.....#...#
.#........
.###..#.##
#..#.....#
#..##..#.#
##.....#.#
#...#.#...
.....#...#
...##.##.#

Tile 1229:
##..#....#
##.#.#...#
#...#..###
#.........
.......#..
...#.....#
#.#.......
..........
#...#.##..
.#...#####

Tile 3691:
.####.#.#.
#..#.##..#
.....#.###
#....#..##
##........
#...##.#.#
#.....#..#
..#.#.....
.##...##.#
#.##..#...

Tile 1019:
...##.#..#
#..#.....#
.........#
##..#..#..
#.....#...
#....#.#..
#.#..#....
#.#...#..#
##....#..#
.#.#####..

Tile 3217:
#.##..##..
#.#...###.
#.#....#.#
.#.#......
##.......#
...#.#..#.
##.#......
#.#.....##
.#........
.######...

Tile 2833:
....###.##
##........
....###...
....##....
.#.#......
..#...##.#
#.##....##
.###.#....
...##..#.#
.#.#....#.

Tile 1493:
...#.#.#.#
#.#..#....
#...#....#
.##......#
..#.##...#
#.........
.........#
##....#..#
#.#.......
.#.#..#..#

Tile 2963:
.##..#..##
#.#.....#.
#........#
#..#.#....
#........#
##....#..#
#.....##.#
###......#
.#....#...
......#..#

Tile 1873:
.###.#.#..
...##.....
#...#.....
.......#.#
.#.....#.#
...#....#.
..#..#....
##..#.#...
..#....###
#.##.#####

Tile 2539:
#..#...#.#
##.......#
#..#..#..#
......#.#.
..........
.###.#.##.
##.#.##..#
.......###
..#.###...
##.####...

Tile 2339:
#.###.#.##
#.....#..#
..........
#.........
......##.#
#..#.###.#
#.........
.......#..
.........#
...##.....

Tile 1303:
....##.###
#.#..#...#
.........#
#.....#.##
.#..#....#
.......#.#
...#....#.
#.####...#
.#.#....#.
##...#..#.

Tile 3539:
.#........
.#..#.##.#
###..##.##
....#....#
#......#..
#.###.#.##
.........#
..#...#.#.
##......#.
.#..#....#

Tile 1153:
#..##.#.##
#.#...#.##
#..##..#..
#..#..#..#
####.#.###
#...#...#.
#.....#...
#..##..#.#
.##.###.##
####.#.###

Tile 2273:
#.#....##.
###..####.
##....####
##.....#..
..#.....#.
....#...##
##........
.#.......#
#........#
.#..#.##.#

Tile 2543:
..###...#.
#..#..#...
####....#.
...###..#.
...#.#..##
###.#.....
#.........
##.....#..
..#...#...
..####...#

Tile 1451:
.#.####.##
.....#.#.#
.##.......
..#......#
...#.#..##
..#......#
#...##..##
#.#.......
#.........
#..#..#...

Tile 3203:
..###.....
#...#....#
###..##...
..........
###....#..
........##
...#......
#......##.
....#.#..#
.###.##...

Tile 1009:
..#.#..##.
##..#....#
#..##...##
##...#...#
##...#..#.
...#...###
....##.#..
....#.##.#
...##.####
....#.#...

Tile 1531:
.....#.##.
.#.####...
....##.#.#
#...#...##
#....##.#.
###......#
..#..##...
#..#.....#
..#....#.#
###.#..#..

Tile 3617:
.##.##.#.#
#....#..#.
.#....#.#.
#.........
.#...##..#
.##.#.##.#
#.#.#.##.#
.....###..
.#..#.##.#
.#.....##.

Tile 2617:
#..##.#..#
#..#....#.
.#.......#
#..#......
.###.####.
..#.....##
..#..#....
..#.......
....#.....
#....#####

Tile 1847:
..#.#...#.
.##....#..
###.#.##.#
..#.##..##
#####...#.
.###.#...#
#.......##
..#.#..#..
...##.#...
.###.#.##.

Tile 3299:
..#.##.##.
...##.....
#........#
...#.##.#.
.#####....
#..#.#..##
#..#..#.##
..#..#...#
#.#.#.....
.#...#..#.

Tile 2591:
......#.#.
#....#...#
##......##
...#...#..
..#.......
.....#.#.#
#.......##
..###...##
#..#..##.#
.....#.##.

Tile 3169:
###...##.#
..#..##..#
#..###...#
.#..#....#
..#......#
....#.#...
.##.#..###
..##...##.
###.......
##..#.####

Tile 3697:
..#.#.#..#
.###.#...#
#.##...##.
.#.##.#...
#..##....#
..........
#....#....
.##.......
#..#.#.##.
#.....#..#

Tile 2551:
#.##..#..#
#..#......
.#..#.....
#....#..#.
#.......##
.#..#....#
.#........
....#.....
.#.##.....
###.#.#...

Tile 2909:
.....#.#..
.#.#.....#
#....##...
#......##.
...#......
##.......#
......###.
#..#.##...
...#...##.
#.##...###

Tile 2027:
.#.#.####.
..##.....#
#...##.###
.##.#.....
##.##....#
....#.#...
#.##....#.
..###..#.#
#...#.#.##
##..#.##.#

Tile 3947:
#.#.#.##.#
.#........
#....##..#
#.........
.....#...#
......#...
#.#.##...#
.##.#.....
.........#
.###.#...#

Tile 3797:
#...####..
.#....##..
#.....#...
.....#.#.#
...#..##..
.....#...#
......##.#
.##...#...
.....##...
.#..#.#.#.

Tile 3187:
##...#..#.
#..#..#..#
#........#
......#.#.
......##..
#.#.......
#.#......#
##...#..##
##..#...##
####...#.#

Tile 1151:
..#..#..##
...#.#....
#.#.#....#
..#......#
...##....#
..#.......
#......#..
#.##..#...
#.#....###
######.#..

Tile 1511:
#...#.....
#.######.#
#.....#...
....#...#.
#..###.#.#
.....#.#.#
....#....#
#..#...##.
#........#
#....#.##.

Tile 2293:
##...#...#
#......#..
.#..#.....
#...###..#
##....#..#
#...##.#.#
....#.....
....#.....
#.....#.##
##.#.##.##

Tile 2131:
#.#..#.#..
#..#...#..
#.##..#...
....##..#.
#........#
#..#.....#
##.......#
####.#...#
.##..#.#..
###..#..#.

Tile 2711:
..###.....
..#.......
..##...##.
##..#..##.
.#...#....
.....#....
#...#....#
.##.#.#..#
#.##.#....
##.#..##.#

Tile 1543:
##.....##.
#...###...
...#.#..#.
#.#...#.##
.#.#.###..
####...###
#..##..#..
####..#.##
#.##...#..
...#..#.#.

Tile 1723:
.#####.###
....##....
##........
#.......#.
#..####..#
.####..##.
.#........
#..#..#...
..........
..#.#.##..

Tile 2819:
..#..##.##
.....#....
#.#.....##
..#.......
..##..#.#.
#....#...#
#...#...#.
..#.......
.........#
#.#..###..
";
        public override int Day => 20;
    }
}